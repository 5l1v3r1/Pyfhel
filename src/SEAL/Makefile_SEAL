##############################################################################################
##############################################################################################
###########################                                     ##############################
###########################            SEAL MAKEFILE            ##############################
###########################                                     ##############################
##############################################################################################
##############################################################################################
#
# DESCRIPTION: Makefile for SEAL encryption library from Microsoft
#
#
# AUTHOR: Alberto Ibarrondo (github @ibarrond)
# DATE: 18/05/2018
#   
#   
# LICENSE: GNU GPL v3
#  
#  This file is part of Pyfhel project
#
#  Pyfhel is free software: you can redistribute it and/or modify
#  it under the terms of the GNU General Public License as published by
#  the Free Software Foundation, either version 3 of the License, or
#  (at your option) any later version.
#
#  Pyfhel is distributed in the hope that it will be useful,
#  but WITHOUT ANY WARRANTY; without even the implied warranty of
#  MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
#  GNU General Public License for more details.
#
#  You should have received a copy of the GNU General Public License
#  along with this program.  If not, see <http://www.gnu.org/licenses/>.
#


find . -name '*.h' -exec sed -i 's-"seal/-"-g' {} \
##############################################################################################
#                                   MAKEFILE VARIABLES                                       #
##############################################################################################

#.................................. LIBRARY VERSIONS  ........................................

SEAL_VERSION=2.3.0

SEAL_DIR=SEAL_v2.3.0-4_Linux

LIBLINK=$(shell cd /usr/local/lib && ls libseal.so.??)

##############################################################################################
#                                         EASY INSTALL                                       #
##############################################################################################


all: downloads decompress gmp ntl linking

downloads:
	wget "https://download.microsoft.com/download/B/3/7/B3720F6B\-4F4A-4B54-9C6C-751EF194CBE7/EAL_v2.3.0-4_Linux.tar.gz"

decompress:
	tar xvf $(SEAL_DIR).tar.gz

seal:
	cd $(SEAL_DIR) && ./configure
	$(MAKE) -C $(SEAL_DIR)
	sudo $(MAKE) install -C $(SEAL_DIR)

linking:
	$(eval $LIBLINK:=$(shell cd /usr/local/lib && ls libseal.so.??))
	sudo ln -sf /usr/local/lib/$($LIBLINK) /usr/lib/$($LIBLINK)



$(info ----------------------GMP & NTL INSTALL MAKEFILE-----------------------)
$(info Dependencies= Pyfhel -> Afhel -> HElib -> NTL & GMP)
$(info $(LIBLINK) Automatic installer. GMP VERSION=$(GMP_VERSION) | NTL VERSION=$(NTL_VERSION))


